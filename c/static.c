/*================================================================
*   Copyright (C) 2021 LuoYe. All rights reserved.
*   
*   文件名称：static.c
*   创 建 者：JangYee
*   创建日期：2021年05月13日
*   描    述：static, const, 全局变量，局部变量（栈），malloc（堆）
*
================================================================*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>


//#define str_len 10
#define str_len 100000
#define str_len_1 (str_len-1)

//查看该变量能否在程序文件中保存
//1.初始化了的全局变量能用strings a.out | grep AAA 看到，未初始化的，在main中memset的看不到
//2.局部变量两种情况都看不到
//3.全局变量初始化不影响a.out的文件大小，局部变量初始化会影响a.out大小
//char g_app_str_pre[str_len] = {65};
char g_app_str_pre[str_len] = {
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65,
    65,65,65,65,65,65,65,65,65,65
    };
char g_app_str[str_len];
void setVal() {
    memset(g_app_str, 'G', str_len_1);
    //char p_app_str[str_len] = {80};
    char p_app_str[str_len] = {
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80,
        80,80,80,80,80,80,80,80,80,80
        };
    //memset(p_app_str, 'P', str_len_1);
    char *h_app_str = malloc(sizeof(char)*str_len);
    memset(h_app_str, 'H', str_len_1);
    printf("%s\n%s\n%s\n%s\n",
        g_app_str_pre,
        g_app_str,
        p_app_str,
        h_app_str);
}
//查看该变量能否在程序文件中保存

//变量地址空间位置，增长方式
int g_a;
int g_b[10];
int g_c;

//全局变量
void showGlobalAddr() {
    //全局变量在小地址，比malloc还小， 向上生长
    printf("%p\n", &g_a);
    printf("%p\n", &g_b[0]);
    printf("%p\n", &g_b[1]);
    printf("%p\n", &g_c);
    //0x6010a8
    //0x601080
    //0x601084
    //0x6010ac
}

//栈空间
void showPrivateAddr() {
    //局部变量在栈空间，高地址，向下生长，连续空间例如p_b向上生长
    int p_a;
    int p_b[10];
    int p_c;
    printf("%p\n", &p_a);
    printf("%p\n", &p_b[0]);
    printf("%p\n", &p_b[1]);
    printf("%p\n", &p_c);
    //0x7ffd8c4c98bc
    //0x7ffd8c4c9890
    //0x7ffd8c4c9894
    //0x7ffd8c4c988c
}

//堆空间
void showHeapAddr() {
    //malloc在堆空间，低地址，向上生长
    int *h_a = malloc(sizeof(int));
    int *h_b = malloc(sizeof(int)*10);
    int *h_c = malloc(sizeof(int));
    printf("%p\n", h_a);
    printf("%p\n", &h_b[0]);
    printf("%p\n", &h_b[1]);
    printf("%p\n", h_c);
    //0x2419010
    //0x2419030
    //0x2419034
    //0x2419060
}

void showAll() {
    printf("show global addr\n");
    showGlobalAddr();
    printf("show private addr\n");
    showPrivateAddr();
    printf("show heap addr\n");
    showHeapAddr();
}
//变量地址空间位置，增长方式

//static变量测试
//静态局部变量的效果跟全局变量基本一致
//普通全局变量对整个工程可见，其他文件可以使用extern外部声明后直接使用。也就是说其他文件不能再定义一个与其相同名字的变量了
//静态全局变量仅对当前文件可见，其他文件不可访问，其他文件可以定义与其同名的变量，两者互不影响。
int *staticTest(int n) {
    int i;
    //si 初始为 0
    static int si;
    for(i=0;i<n;i++) {
        //先打印，再++
        printf("si is %d\n", si++);
    }
    return &si;
}
//static变量测试

//const变量测试
void constTest() {
    char const a1; //simple as const char a1;
    printf("const default val is %d\n", a1);
    char const a2 = 'a';
    //a2 = 'b';   //error: assignment of read-only variable
    char v;
    char const * p1;    //可以改变指针指向的地址，不能改地址上的值
    char * const p2;
    char * const p3 = &v;   //可以改指向地址上的值，不能改指向的地址
    printf("const default addr : p1 addr is %p\t p2 addr is %p\n", p1, p2);
    //p1 addr is 0x7fff6d3fc370  p2 addr is 0x2004024cd
    p1 = &v;
    //*p1 = 'a';    //assignment of read-only location
    //p2 = &v;      //assignment of read-only location
    //*p2 = 'a';    //运行段错误，野指针赋值
    *p3 = 'a';
}

//const变量测试

int main() {
    int *p;
    staticTest(2);
    p = staticTest(2);
    //全局变量地址空间，应该同类型
    printf("si addr is %p\n", p);
    //si addr is 0x601064
    *p = 100;
    staticTest(2);
    constTest();
    showAll();
    setVal();
    return 0;
}


/*
si is 0
si is 1
si is 2
si is 3
si addr is 0x601064
si is 100
si is 101
show global addr
0x6010a8
0x601080
0x601084
0x6010ac
show private addr
0x7ffd8c4c98bc
0x7ffd8c4c9890
0x7ffd8c4c9894
0x7ffd8c4c988c
show heap addr
0x2419010
0x2419030
0x2419034
0x2419060
*/
